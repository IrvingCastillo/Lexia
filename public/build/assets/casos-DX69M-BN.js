import{s as r,h as l}from"./modalHelper-md1zrCQj.js";import{b as D,M as f}from"./bootstrap.esm-CU4uQQQ5.js";window.bootstrap=D;document.querySelector("#gestionarCaso");const T=document.querySelector("#time-line"),B=document.querySelector("#DatosInf"),x=document.querySelector("#DatosSup"),I=document.querySelector(".DatosHoras"),P=document.querySelector(".ArchivosCasos"),F=document.querySelector("#agregarCaso"),G=document.querySelector("#agregarArchivo"),U=document.querySelector("#card-template"),j=document.querySelector("#contenedor-casos"),p=document.querySelector("#id_case"),A=document.querySelector("#visualizarArchivos"),J=document.querySelector("#span-titulo"),k=document.querySelector("#btnArchivos"),E=document.querySelector("#edit-status"),V=document.querySelector("#btnEliminar"),M=document.querySelector("#btnEditCaso"),q=document.querySelector("#showListaCasos"),z=document.querySelector("#btnAltaCaso"),w=document.querySelector("#barraBusqueda"),Y=document.querySelector("#tipoEliminar"),W=document.querySelector("#tituloEliminar"),y=new f(document.getElementById("modalCarga"),{backdrop:"static",keyboard:!1}),d=new f(document.getElementById("modalError")),h=new f(document.getElementById("modalSuccess"));new f(document.getElementById("modalMensajePago"));new f(document.getElementById("modalNuevoCaso"));const g=document.getElementById("mensajeExito"),_=document.getElementById("mensaje-vacio");L();K();async function L(){try{const a=await(await fetch("/get-token")).json(),e=await(await fetch("https://api.lexialegal.site/api/legal-cases",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${a.token}`}})).json(),s=e.data[0];j.innerHTML="",p.value="",k.style.display="none",w.style.display="none",e.data.forEach(o=>{const n=U.content.cloneNode(!0),c=["inicio_caso","revision_documentos","proceso","sentencia"],u={inicio_caso:"Inicio de caso",revision_documentos:"En RevisiÃ³n de documentos",proceso:"En Proceso",sentencia:"Caso sentenciado"};n.querySelector(".titulo-caso").textContent=o.caso_nombre,n.querySelector(".descripcion-caso").textContent=o.description,n.querySelector(".estado-caso").textContent=u[o.status],n.querySelector(".gestionarCaso").addEventListener("click",()=>{p.value=o.id,setTimeout(()=>{Q(o)},500)}),n.querySelector(".eliminarCaso").addEventListener("click",()=>{p.value=o.id,Y.innerHTML="caso?",W.innerHTML=o.caso_nombre}),j.appendChild(n)})}catch(t){console.log(t),r(d),l(d,2e3)}}async function K(){try{const a=await(await fetch("/get-token")).json(),i=await fetch("https://api.lexialegal.site/api/users/attorneys",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${a.token}`}}),e=await i.json();console.log(e),i.ok&&(e.data.forEach(s=>{$("#attorneys").append(`<option value="${s.id}">${s.nombre_cliente}</option>`)}),$("#attorneys").multiselect({templates:{li:'<li class="color-multiselect"><a href="javascript:void(0);"><label></label></a></li>'},maxHeight:150,enableCaseInsensitiveFiltering:!0,nSelectedText:" - Abogados seleccionados",buttonWidth:"100%",nonSelectedText:"No hay abogados seleccionados",allSelectedText:"Todos los abogados seleccionados",filterPlaceholder:"Buscar"}))}catch{r(d),l(d,2e3)}}function Q(t){q.style.display="inline",z.style.display="none",J.innerHTML=t.caso_nombre,x.classList.add("cardHide"),B.classList.remove("cardHide"),I.classList.add("show"),P.classList.add("show"),k.style.display="block",w.style.display="flex",T.classList.add("show"),N(t.status),X(t),t.documents.length>0?(console.log(t),_.style.display="none",S(t.documents)):_.style.display="block"}function X(t){console.log(t);const a=document.getElementById("contenedor-toggles");a.innerHTML="";const e=document.getElementById("toggles-template").content.cloneNode(!0);e.querySelector("#config_notify_email").checked=!!t.notify_email,e.querySelector("#config_notify_client").checked=!!t.notify_client,e.querySelector("#config_notify_attorneys").checked=!!t.notify_attorneys,a.appendChild(e)}function N(t){const a=document.getElementById("timeline-container");a.innerHTML="";const e=document.getElementById("timeline-template").content.cloneNode(!0),s=e.querySelectorAll("li.time-line-item");let o=!1;s.forEach(n=>{const c=n.dataset.status,u=n.querySelector(".content-time-line"),m=n.querySelector(".icon, .icon-pending");n.querySelector(".fecha"),n.classList.remove("status-completed","status-pending"),u.classList.remove("active"),m&&(m.classList.remove("icon","icon-pending"),m.classList.add("icon")),o?(n.classList.add("status-pending"),m&&(m.classList.remove("icon"),m.classList.add("icon-pending"))):(n.classList.add("status-completed"),u.classList.add("active"),c===t&&(o=!0))}),t==="sentencia"?E.disabled=!0:E.disabled=!1,a.appendChild(e)}function S(t){const a=document.querySelector("#file-template"),i=document.querySelector("#contenedor-archivos");if(i.innerHTML="",!t||t.length===0){_.style.display="block";return}_.style.display="none",t.forEach(e=>{const s=a.content.cloneNode(!0);let o;if(e.type==="application/pdf")o=document.createElement("embed"),o.src="https://api.lexialegal.site/storage/"+e.path,o.type="application/pdf",o.width="100%",o.height="500px";else if(e.type==="application/vnd.openxmlformats-officedocument.wordprocessingml.document"){const c=encodeURIComponent("https://api.lexialegal.site/storage/"+e.path);o=document.createElement("iframe"),o.src=`https://docs.google.com/gview?url=${c}&embedded=true`,o.width="100%",o.height="500px",o.frameBorder="0"}else o=document.createElement("div"),o.textContent="Tipo de archivo no soportado para vista previa.",o.style.color="red";s.querySelector(".nombre-archivo").textContent=e.name;const n=ee(e.uploaded_at);s.querySelector(".fecha-archivo").textContent=n,s.querySelector(".borrar-archivo").addEventListener("click",c=>{c.preventDefault(),console.log("Borrar archivo ID:",e.id),Z(e.id)}),s.querySelector(".nombre-archivo").addEventListener("click",()=>{console.log("Mostrar archivo ID:",e.id),A.innerHTML="",A.appendChild(o)}),i.appendChild(s)})}w.addEventListener("input",async t=>{const a=t.target.value.toLowerCase(),e=await(await fetch("/get-token")).json();let s={legal_case_id:p.value};const o=new URLSearchParams(s).toString(),u=(await(await fetch(`https://api.lexialegal.site/api/legal-cases/show/cases?${o}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${e.token}`}})).json()).data.documents.filter(m=>m.name.toLowerCase().includes(a));S(u)});$(".dropdown-menu").on("click",function(t){t.stopPropagation()});async function Z(t){r(y),await new Promise(a=>setTimeout(a,2e3)),l(y);try{const i=await(await fetch("/get-token")).json();let e={document_id:t};const s=await fetch("https://api.lexialegal.site/api/legal-cases/delete/file",{method:"POST",headers:{Authorization:`Bearer ${i.token}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)}),o=await s.json();if(console.log(o),s.ok){let n={legal_case_id:p.value};const c=new URLSearchParams(n).toString(),u=await fetch(`https://api.lexialegal.site/api/legal-cases/show/cases?${c}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${i.token}`}}),m=await u.json();u.ok&&(g.textContent=o.message,r(h),l(h,2e3,()=>{$("#modalNuevoCaso").modal({hide:!0}),console.log(o.data),S(m.data.documents)}))}}catch{r(d),l(d,2e3)}}function ee(t){const a=["ENE","FEB","MAR","ABR","MAY","JUN","JUL","AGO","SEP","OCT","NOV","DIC"],i=new Date(t),e=i.getDate().toString().padStart(2,"0"),s=a[i.getMonth()],o=i.getFullYear();return`${e} ${s} ${o}`}function te(){const t=new Date,a=t.getHours(),i=t.getMinutes(),e=t.getSeconds(),s=`${a.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`;document.getElementById("reloj").textContent=s}setInterval(te,1e3);$(".archivo").on("change",function(){var a;this.name;let t=(a=this.files[0])==null?void 0:a.name;t==null?document.querySelector("#fileName").innerHTML="":(document.querySelector(".showFile").style.display="block",document.querySelector("#fileName").innerHTML=`${t}  <i class="fas fa-check text-success"></i>`)});q.addEventListener("click",()=>{w.style.display="none",z.style.display="block",M.style.display="none",k.style.display="none",B.classList.add("cardHide"),T.classList.remove("show"),P.classList.remove("show"),I.classList.remove("show"),q.style.display="none",setTimeout(()=>{x.classList.remove("cardHide")},2e3)});E.addEventListener("click",async t=>{r(y),await new Promise(a=>setTimeout(a,2e3)),l(y);try{const i=await(await fetch("/get-token")).json();let e={legal_case_id:p.value};const s=new URLSearchParams(e).toString(),n=await(await fetch(`https://api.lexialegal.site/api/legal-cases/show/cases?${s}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${i.token}`}})).json();let c="";n.data.status=="inicio_caso"?c="revision_documentos":n.data.status=="revision_documentos"?c="proceso":n.data.status=="proceso"&&(c="sentencia");const u=p.value,m=c,v=document.querySelector("#config_notify_email"),H=document.querySelector("#config_notify_client"),O=document.querySelector("#config_notify_attorneys");let R={legal_case_id:u,status:c,config_notify_client:!!H.checked,config_notify_attorneys:!!O.checked,config_notify_email:!!v.checked};const b=await fetch("https://api.lexialegal.site/api/legal-cases/change/status/cases",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${i.token}`},body:JSON.stringify(R)}),C=await b.json();b.ok&&(g.textContent=C.message,r(h),l(h,2e3,()=>{$("#modalNuevoCaso").modal({hide:!0}),console.log(C.data),N(C.data.status)}))}catch{r(d),l(d,2e3)}});G.addEventListener("click",async t=>{r(y),await new Promise(a=>setTimeout(a,2e3)),l(y);try{let a=document.querySelector('input[name="documents[]"]').files[0];const e=await(await fetch("/get-token")).json();let s={legal_case_id:p.value};const o=new URLSearchParams(s).toString(),n=new FormData;n.append("legal_case_id",p.value),n.append("documents[]",a);const c=await fetch("https://api.lexialegal.site/api/legal-cases/upload/files",{method:"POST",headers:{Authorization:`Bearer ${e.token}`,Accept:"application/json"},body:n}),u=await c.json();if(c.ok){const m=await fetch(`https://api.lexialegal.site/api/legal-cases/show/cases?${o}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${e.token}`}}),v=await m.json();m.ok&&(g.textContent=u.message,r(h),l(h,2e3,()=>{$("#modalArchivoCaso").modal({hide:!0}),S(v.data.documents)}))}}catch{r(d),l(d,2e3)}});F.addEventListener("click",async t=>{g.textContent="";const a=document.querySelector("#AltaCaso"),i=new FormData(a);r(y),await new Promise(e=>setTimeout(e,2e3)),l(y);try{const s=await(await fetch("/get-token")).json(),o=await fetch("https://api.lexialegal.site/api/legal-cases",{method:"POST",headers:{Authorization:`Bearer ${s.token}`,Accept:"application/json"},body:i}),n=await o.json();o.ok?(g.textContent=n.message,r(h),l(h,2e3,()=>{$("#modalNuevoCaso").modal({hide:!0}),L()})):(r(d),l(d,2e3,()=>{}))}catch{r(d),l(d,2e3)}});V.addEventListener("click",async t=>{r(y),await new Promise(a=>setTimeout(a,2e3)),l(y);try{const i=await(await fetch("/get-token")).json();let e={legal_case_id:p.value};const s=await fetch("https://api.lexialegal.site/api/legal-cases/delete/case",{method:"POST",headers:{Authorization:`Bearer ${i.token}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)}),o=await s.json();s.ok?(g.textContent=o.message,r(h),l(h,2e3,()=>{$("#modalEliminar").modal({hide:!0}),L()})):(r(d),l(d,2e3,()=>{}))}catch{r(d),l(d,2e3,()=>{})}});M.addEventListener("click",async t=>{try{const i=await(await fetch("/get-token")).json();let e={legal_case_id:p.value};const s=new URLSearchParams(e).toString(),n=await(await fetch(`https://api.lexialegal.site/api/legal-cases/show/cases?${s}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${i.token}`}})).json();let c=n.data;console.log(n.data),document.getElementById("caso_nombre_edit").value=c.caso_nombre,document.getElementById("client_name_edit").value="",document.getElementById("description_edit").value=c.description,document.getElementById("case_type_edit").value=c.case_type}catch{r(d),l(d)}});
