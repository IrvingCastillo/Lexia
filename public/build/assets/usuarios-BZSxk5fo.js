import{s,h as l}from"./modalHelper-md1zrCQj.js";import{b as h,M as p}from"./bootstrap.esm-CU4uQQQ5.js";window.bootstrap=h;const w=document.querySelector("#id_user"),c=new p(document.getElementById("modalCarga"),{backdrop:"static",keyboard:!1}),i=new p(document.getElementById("modalError")),d=new p(document.getElementById("modalSuccess")),u=document.getElementById("mensajeExito"),_=document.getElementById("mensajeError"),b=document.querySelector("#addUser");y();async function y(){try{const o=await(await fetch("/get-token")).json(),n=await fetch("https://api.lexialegal.site/api/usuarios/obtener/integrantes",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${o.token}`}}),a=await n.json();n.ok&&(console.log(a),E(a.data))}catch{s(i),l(i,2e3)}}async function E(r){const o=document.querySelector("#usuario-template"),n=document.querySelector("#contenedor-usuarios"),a=document.querySelector("#mensaje-vacio");if(n.innerHTML="",!r||r.length===0){a.style.display="block";return}else a.style.display="none";r.forEach(e=>{const t=o.content.cloneNode(!0);t.querySelector(".avatar-usuario").src=e.avatar||"https://media.istockphoto.com/id/1300845620/es/vector/icono-de-usuario-plano-aislado-sobre-fondo-blanco-s%C3%ADmbolo-de-usuario-ilustraci%C3%B3n-vectorial.jpg?s=612x612&w=0&k=20&c=grBa1KTwfoWBOqu1n0ewyRXQnx59bNHtHjvbsFc82gk=",t.querySelector(".nombre-usuario").textContent=e.nombre_cliente,t.querySelector(".rol-usuario").textContent=e.roles[0].name,t.querySelector(".telefono-usuario").textContent=e.profile.telefono,t.querySelector(".fecha-usuario").textContent="",t.querySelector(".btn-editar").addEventListener("click",()=>{console.log("Editar usuario:",e.id),w.value=e.id,$("#modalEditarUsuario").modal("show"),document.getElementById("nombre_cliente_edit").value=e.nombre_cliente,document.getElementById("apellido_paterno_edit").value=e.profile.apellido_paterno,document.getElementById("apellido_materno_edit").value=e.profile.apellido_materno,document.getElementById("telefono_edit").value=e.profile.telefono,document.getElementById("email_edit").value=e.email}),t.querySelector(".btn-remover").addEventListener("click",()=>{console.log("Remover usuario:",e.id),j(e.id)}),n.appendChild(t)})}async function j(r){s(c),await new Promise(o=>setTimeout(o,2e3)),l(c);try{const n=await(await fetch("/get-token")).json();let a={id_user:r};const e=await fetch("https://api.lexialegal.site/api/usuarios/remove",{method:"POST",headers:{Authorization:`Bearer ${n.token}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(a)}),t=await e.json();console.log(t),console.log(e),e.ok&&(s(d),u.textContent=t.message,l(d,2e3),y())}catch(o){console.log(o),s(i),l(i,2e3)}}b.addEventListener("click",async r=>{console.log("lapt");const o=document.querySelector("#AltaUsuarios");if(new FormData(o),o.checkValidity()){u.textContent="",s(c),await new Promise(n=>setTimeout(n,2e3)),l(c);try{let n=document.querySelector("#AltaUsuarios"),a=new FormData(n),e=Object.fromEntries(a.entries()),t=JSON.stringify(e);const f=await(await fetch("/get-token")).json();console.log(t);const g=await fetch("https://api.lexialegal.site/api/usuarios/agregar/integrantes",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${f.token}`},body:t}),m=await g.json();g.ok?(console.log(m.data),u.textContent=m.message,s(d),l(d,2e3,()=>{$("#modalNuevoCaso").modal({hide:!0}),y()})):(_.textContent=m.message,s(i),l(i,4e3))}catch{s(i),l(i,2e3)}}else{console.log("alv"),console.log(o.checkValidity()),o.reportValidity();return}});
