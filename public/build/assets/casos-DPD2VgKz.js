import{s as d,h as l}from"./modalHelper-md1zrCQj.js";import{b as V,M as f}from"./bootstrap.esm-CU4uQQQ5.js";window.bootstrap=V;document.querySelector("#gestionarCaso");const x=document.querySelector("#time-line"),I=document.querySelector("#DatosInf"),M=document.querySelector("#DatosSup"),P=document.querySelector(".DatosHoras"),H=document.querySelector(".ArchivosCasos"),Y=document.querySelector("#agregarCaso"),W=document.querySelector("#agregarArchivo"),K=document.querySelector("#card-template"),E=document.querySelector("#contenedor-casos"),p=document.querySelector("#id_case"),L=document.querySelector("#id_file"),j=document.querySelector("#visualizarArchivos"),Q=document.querySelector("#span-titulo"),k=document.querySelector("#btnArchivos"),q=document.querySelector("#edit-status"),X=document.querySelector("#btnEliminar"),N=document.querySelector("#btnEditCaso"),b=document.querySelector("#showListaCasos"),z=document.querySelector("#btnAltaCaso"),w=document.querySelector("#barraBusqueda"),D=document.querySelector("#filtradoCasos");document.querySelectorAll(".dropdown-filtro");const F=document.querySelector("#tipoEliminar"),O=document.querySelector("#tituloEliminar"),y=new f(document.getElementById("modalCarga"),{backdrop:"static",keyboard:!1}),r=new f(document.getElementById("modalError")),h=new f(document.getElementById("modalSuccess"));new f(document.getElementById("modalMensajePago"));const Z=new f(document.getElementById("modalNuevoCaso")),g=document.getElementById("mensajeExito"),_=document.getElementById("mensaje-vacio");A();ee();async function A(){try{const o=await(await fetch("/get-token")).json(),e=await(await fetch("https://api.lexialegal.site/api/legal-cases",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${o.token}`}})).json(),i=e.data[0];E.innerHTML="",p.value="",k.style.display="none",w.style.display="none",e.data.forEach(a=>{const s=K.content.cloneNode(!0),c=["inicio_caso","revision_documentos","proceso","sentencia"],m={inicio_caso:"Inicio de caso",revision_documentos:"En RevisiÃ³n de documentos",proceso:"En Proceso",sentencia:"Caso sentenciado"};s.querySelector(".titulo-caso").textContent=a.caso_nombre,s.querySelector(".descripcion-caso").textContent=a.description,s.querySelector(".estado-caso").textContent=m[a.status],s.querySelector(".card-caso").setAttribute("data-status",a.status),s.querySelector(".gestionarCaso").addEventListener("click",()=>{p.value=a.id,setTimeout(()=>{te(a)},500)}),s.querySelector(".eliminarCaso").addEventListener("click",()=>{p.value=a.id,F.innerHTML="caso?",O.innerHTML=a.caso_nombre}),E.appendChild(s)})}catch(t){console.log(t),d(r),l(r,2e3)}}async function ee(){try{const o=await(await fetch("/get-token")).json(),n=await fetch("https://api.lexialegal.site/api/users/attorneys",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${o.token}`}}),e=await n.json();console.log(e),n.ok&&(e.data.forEach(i=>{$("#attorneys").append(`<option value="${i.id}">${i.nombre_cliente}</option>`)}),$("#attorneys").multiselect({templates:{li:'<li class="color-multiselect"><a href="javascript:void(0);"><label></label></a></li>'},maxHeight:150,enableCaseInsensitiveFiltering:!0,nSelectedText:" - Abogados seleccionados",buttonWidth:"100%",nonSelectedText:"No hay abogados seleccionados",allSelectedText:"Todos los abogados seleccionados",filterPlaceholder:"Buscar"}))}catch{d(r),l(r,2e3)}}function te(t){b.style.display="inline",z.style.display="none",D.style.display="none",Q.innerHTML=t.caso_nombre,M.classList.add("cardHide"),I.classList.remove("cardHide"),P.classList.add("show"),H.classList.add("show"),k.style.display="block",w.style.display="flex",x.classList.add("show"),R(t.status),oe(t),t.documents.length>0?(console.log(t),_.style.display="none",v(t.documents)):_.style.display="block"}function oe(t){console.log(t);const o=document.getElementById("contenedor-toggles");o.innerHTML="";const e=document.getElementById("toggles-template").content.cloneNode(!0);e.querySelector("#config_notify_email").checked=!!t.notify_email,e.querySelector("#config_notify_client").checked=!!t.notify_client,e.querySelector("#config_notify_attorneys").checked=!!t.notify_attorneys,o.appendChild(e)}function R(t){const o=document.getElementById("timeline-container");o.innerHTML="";const e=document.getElementById("timeline-template").content.cloneNode(!0),i=e.querySelectorAll("li.time-line-item");let a=!1;i.forEach(s=>{const c=s.dataset.status,m=s.querySelector(".content-time-line"),u=s.querySelector(".icon, .icon-pending");s.querySelector(".fecha"),s.classList.remove("status-completed","status-pending"),m.classList.remove("active"),u&&(u.classList.remove("icon","icon-pending"),u.classList.add("icon")),a?(s.classList.add("status-pending"),u&&(u.classList.remove("icon"),u.classList.add("icon-pending"))):(s.classList.add("status-completed"),m.classList.add("active"),c===t&&(a=!0))}),t==="sentencia"?q.disabled=!0:q.disabled=!1,o.appendChild(e)}function v(t){const o=document.querySelector("#file-template"),n=document.querySelector("#contenedor-archivos");if(n.innerHTML="",!t||t.length===0){_.style.display="block";return}_.style.display="none",t.forEach(e=>{const i=o.content.cloneNode(!0);let a;if(e.type==="application/pdf")a=document.createElement("embed"),a.src="https://api.lexialegal.site/storage/"+e.path,a.type="application/pdf",a.width="100%",a.height="500px";else if(e.type==="application/vnd.openxmlformats-officedocument.wordprocessingml.document"){const c=encodeURIComponent("https://api.lexialegal.site/storage/"+e.path);a=document.createElement("iframe"),a.src=`https://docs.google.com/gview?url=${c}&embedded=true`,a.width="100%",a.height="500px",a.frameBorder="0"}else a=document.createElement("div"),a.textContent="Tipo de archivo no soportado para vista previa.",a.style.color="red";i.querySelector(".nombre-archivo").textContent=e.name;const s=ne(e.uploaded_at);i.querySelector(".fecha-archivo").textContent=s,i.querySelector(".borrar-archivo").addEventListener("click",c=>{c.preventDefault(),console.log("Borrar archivo ID:",e.id),console.log(e),L.value=e.id,F.innerHTML="archivo?",O.innerHTML=e.name}),i.querySelector(".nombre-archivo").addEventListener("click",()=>{console.log("Mostrar archivo ID:",e.id),j.innerHTML="",j.appendChild(a)}),n.appendChild(i)})}w.addEventListener("input",async t=>{const o=t.target.value.toLowerCase(),e=await(await fetch("/get-token")).json();let i={legal_case_id:p.value};const a=new URLSearchParams(i).toString(),m=(await(await fetch(`https://api.lexialegal.site/api/legal-cases/show/cases?${a}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${e.token}`}})).json()).data.documents.filter(u=>u.name.toLowerCase().includes(o));v(m)});$(".dropdown-menu").on("click",function(t){t.stopPropagation()});$("#btnAltaCaso").on("click",()=>{$("#modalNuevoCaso").modal("show")});$("#btnArchivos").on("click",()=>{$("#modalArchivoCaso").modal("show"),document.getElementById("archivo_caso").value="",document.querySelector(".showFile").style.display="none",document.querySelector("#fileName").innerHTML=""});async function ae(t){d(y),await new Promise(o=>setTimeout(o,2e3)),l(y);try{const n=await(await fetch("/get-token")).json();let e={document_id:t};const i=await fetch("https://api.lexialegal.site/api/legal-cases/delete/file",{method:"POST",headers:{Authorization:`Bearer ${n.token}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)}),a=await i.json();if(console.log(a),i.ok){let s={legal_case_id:p.value};const c=new URLSearchParams(s).toString(),m=await fetch(`https://api.lexialegal.site/api/legal-cases/show/cases?${c}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${n.token}`}}),u=await m.json();m.ok&&v(u.data.documents)}}catch{d(r),l(r,2e3)}}function ne(t){const o=["ENE","FEB","MAR","ABR","MAY","JUN","JUL","AGO","SEP","OCT","NOV","DIC"],n=new Date(t),e=n.getDate().toString().padStart(2,"0"),i=o[n.getMonth()],a=n.getFullYear();return`${e} ${i} ${a}`}function se(){const t=new Date,o=t.getHours(),n=t.getMinutes(),e=t.getSeconds(),i=`${o.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`;document.getElementById("reloj").textContent=i}setInterval(se,1e3);$(".archivo").on("change",function(){var o;this.name;let t=(o=this.files[0])==null?void 0:o.name;t==null?document.querySelector("#fileName").innerHTML="":(document.querySelector(".showFile").style.display="block",document.querySelector("#fileName").innerHTML=`${t}  <i class="fas fa-check text-success"></i>`)});const ie=document.querySelector(".dropdown-menu.dropdown-filtro"),B=document.getElementById("filtradoCasos"),ce=document.getElementById("filterLabel");ie.addEventListener("click",t=>{const o=t.target.closest("a[data-filter]");if(!o)return;t.preventDefault();const n=o.dataset.filter,e=o.dataset.label;ce.textContent=e,E.querySelectorAll(".card-caso").forEach(a=>{const s=a.getAttribute("data-status"),c=n==="todos"||s===n;a.classList.toggle("d-none",!c)}),typeof $<"u"&&$(B).dropdown&&$(B).dropdown("toggle")});b.addEventListener("click",()=>{p.value="",L.value="",w.style.display="none",z.style.display="block",D.style.display="inline",N.style.display="none",k.style.display="none",I.classList.add("cardHide"),x.classList.remove("show"),H.classList.remove("show"),P.classList.remove("show"),b.style.display="none",setTimeout(()=>{M.classList.remove("cardHide")},2e3)});q.addEventListener("click",async t=>{d(y),await new Promise(o=>setTimeout(o,2e3)),l(y);try{const n=await(await fetch("/get-token")).json();let e={legal_case_id:p.value};const i=new URLSearchParams(e).toString(),s=await(await fetch(`https://api.lexialegal.site/api/legal-cases/show/cases?${i}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${n.token}`}})).json();let c="";s.data.status=="inicio_caso"?c="revision_documentos":s.data.status=="revision_documentos"?c="proceso":s.data.status=="proceso"&&(c="sentencia");const m=p.value,u=c,S=document.querySelector("#config_notify_email"),G=document.querySelector("#config_notify_client"),U=document.querySelector("#config_notify_attorneys");let J={legal_case_id:m,status:c,config_notify_client:!!G.checked,config_notify_attorneys:!!U.checked,config_notify_email:!!S.checked};const T=await fetch("https://api.lexialegal.site/api/legal-cases/change/status/cases",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${n.token}`},body:JSON.stringify(J)}),C=await T.json();T.ok&&(g.textContent=C.message,d(h),l(h,2e3,()=>{$("#modalNuevoCaso").modal({hide:!0}),console.log(C.data),R(C.data.status)}))}catch{d(r),l(r,2e3)}});W.addEventListener("click",async t=>{let o=document.querySelector('input[name="documents[]"]').files[0];const n=new FormData;if(n.append("legal_case_id",p.value),n.append("documents[]",o),!o)$("#modalMensajeArchivo").modal("show").on("shown.bs.modal",function(){document.getElementById("mensajeArchivo").innerHTML="Por favor, sube el archivo",setTimeout(()=>{$("#modalMensajeArchivo").modal("hide")},2e3)});else{$("#modalArchivoCaso").modal("hide"),d(y),await new Promise(e=>setTimeout(e,2e3)),l(y);try{const i=await(await fetch("/get-token")).json();let a={legal_case_id:p.value};const s=new URLSearchParams(a).toString(),c=await fetch("https://api.lexialegal.site/api/legal-cases/upload/files",{method:"POST",headers:{Authorization:`Bearer ${i.token}`,Accept:"application/json"},body:n}),m=await c.json();if(c.ok){const u=await fetch(`https://api.lexialegal.site/api/legal-cases/show/cases?${s}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${i.token}`}}),S=await u.json();u.ok&&v(S.data.documents)}}catch{d(r),l(r,2e3)}}});Y.addEventListener("click",async t=>{g.textContent="";const o=document.querySelector("#AltaCaso"),n=new FormData(o);if(o.checkValidity()){setTimeout(()=>{l(Z)},100),d(y),await new Promise(e=>setTimeout(e,2e3)),l(y);try{const i=await(await fetch("/get-token")).json(),a=await fetch("https://api.lexialegal.site/api/legal-cases",{method:"POST",headers:{Authorization:`Bearer ${i.token}`,Accept:"application/json"},body:n}),s=await a.json();a.ok?(g.textContent=s.message,d(h),l(h,2e3,()=>{$("#modalNuevoCaso").modal({hide:!0}),A()})):(d(r),l(r,2e3,()=>{}))}catch{d(r),l(r,2e3)}}else{console.log(o.checkValidity()),o.reportValidity();return}});X.addEventListener("click",async t=>{let o=L.value;if(o!=="")console.log("eliminar archivo"),ae(o);else{d(y),await new Promise(n=>setTimeout(n,2e3)),l(y);try{const e=await(await fetch("/get-token")).json();let i={legal_case_id:p.value};const a=await fetch("https://api.lexialegal.site/api/legal-cases/delete/case",{method:"POST",headers:{Authorization:`Bearer ${e.token}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(i)}),s=await a.json();a.ok?(g.textContent=s.message,d(h),l(h,2e3,()=>{$("#modalEliminar").modal({hide:!0}),A()})):(d(r),l(r,2e3,()=>{}))}catch{d(r),l(r,2e3,()=>{})}}});N.addEventListener("click",async t=>{try{const n=await(await fetch("/get-token")).json();let e={legal_case_id:p.value};const i=new URLSearchParams(e).toString(),s=await(await fetch(`https://api.lexialegal.site/api/legal-cases/show/cases?${i}`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${n.token}`}})).json();let c=s.data;console.log(s.data),document.getElementById("caso_nombre_edit").value=c.caso_nombre,document.getElementById("client_name_edit").value="",document.getElementById("description_edit").value=c.description,document.getElementById("case_type_edit").value=c.case_type}catch{d(r),l(r)}});
