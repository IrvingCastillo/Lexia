import{s as p,h as g}from"./modalHelper-md1zrCQj.js";import{b as A,M as v}from"./bootstrap.esm-CU4uQQQ5.js";window.bootstrap=A;new v(document.getElementById("modalCarga"),{backdrop:"static",keyboard:!1});const k=new v(document.getElementById("modalError")),f=new v(document.getElementById("modalSuccess")),l=document.querySelector("#resumen"),d=document.querySelector("#resumir"),i=document.querySelector("#pregunta"),r=document.getElementById("dropZone"),E=document.getElementById("fileInput"),w=document.getElementById("fileList"),C=document.querySelector("#editor"),s=document.getElementById("startIA"),b=document.querySelector("#downloadPdf"),y=document.querySelector("#showDropFiles");document.getElementById("mensajeCarga");const h=document.getElementById("mensajeExito");let o=[];l.addEventListener("change",function(){this.checked==!0?(d.checked=!1,d.disabled=!0,i.disabled=!0,i.value="",o.length!==0?s.style.display="block":s.style.display="none"):(s.style.display="none",d.disabled=!1,i.disabled=!1)});d.addEventListener("change",function(){this.checked==!0?(l.checked=!1,l.disabled=!0,i.disabled=!0,i.value="",o.length!==0?s.style.display="block":s.style.display="none"):(s.style.display="none",l.disabled=!1,i.disabled=!1)});i.addEventListener("input",function(){this.value.length<5?(l.disabled=!1,d.disabled=!1,s.style.display="none"):(l.checked=!1,l.disabled=!0,d.checked=!1,d.disabled=!0,o.length!==0?s.style.display="block":s.style.display="none")});s.addEventListener("click",async e=>{document.getElementById("listadoDocumento").classList.add("cardHide"),setTimeout(()=>{document.getElementById("divEditor").classList.remove("cardHide"),y.style.display="inline"},2500),await z()});y.addEventListener("click",()=>{document.getElementById("divEditor").classList.add("cardHide"),setTimeout(()=>{document.getElementById("listadoDocumento").classList.remove("cardHide"),y.style.display="none"},1500)});const m=new Quill("#editor",{theme:"snow"});b.addEventListener("click",async()=>{h.innerText="En un momento se descarga el archivo",p(f);const{jsPDF:e}=window.jspdf,t=new e,n=m.getText(),a=25,c=20,L=20,I=20;t.setFont("times","normal"),t.setFontSize(12);const S=t.internal.pageSize.getWidth(),M=t.internal.pageSize.getHeight(),j=S-a-c,T=6,D=4,F=n.split(/\n+/);let u=L;F.forEach(H=>{t.splitTextToSize(H,j).forEach(q=>{u+T>M-I&&(t.addPage(),u=L),t.text(q,a,u),u+=T}),u+=D}),setTimeout(()=>{g(f),t.save("contenido.pdf")},1e3)});function P(e,t=50){m.setText("");const n=document.createElement("span");n.classList.add("cursor"),C.appendChild(n);let a=0;function c(){a<e.length?(m.insertText(a,e[a]),a++,setTimeout(c,t+Math.random()*10)):(m.setSelection(m.getLength(),0),b.style.display="block")}setTimeout(()=>{c()},1e3)}r.addEventListener("click",()=>E.click());r.addEventListener("dragover",e=>{e.preventDefault(),r.classList.add("dragover")});r.addEventListener("dragleave",()=>{r.classList.remove("dragover")});r.addEventListener("drop",e=>{e.preventDefault(),r.classList.remove("dragover"),x(e.dataTransfer.files)});E.addEventListener("change",e=>{x(e.target.files)});function x(e){for(let t of e){if(o.length>=2){$("#modalMensajeArchivo").modal("show").on("shown.bs.modal",function(){document.getElementById("mensajeArchivo").innerHTML="Solo puedes subir máximo 2 archivos",setTimeout(()=>{$("#modalMensajeArchivo").modal("hide")},2e3)});break}t.type==="application/pdf"||t.name.endsWith(".docx")?o.push(t):$("#modalMensajeArchivo").modal("show").on("shown.bs.modal",function(){document.getElementById("mensajeArchivo").innerHTML="Solo se permiten archivos PDF o DOCX",setTimeout(()=>{$("#modalMensajeArchivo").modal("hide")},2e3)})}B()}function B(){w.innerHTML="",o.forEach((e,t)=>{const n=document.createElement("li");n.className="list-group-item file-item mt-1 normal-texto",n.style.borderColor="#132c47",n.style.background="#132c47",n.style.color="#fff",n.innerHTML=`
      <span>${e.name} (${(e.size/1024).toFixed(1)} KB)</span>
      <button class="btn btn-sm text-white"> <i class="fas fa-trash"></i> </button>
    `,n.querySelector("button").addEventListener("click",()=>{o.length===1&&(console.log(o.length),s.style.display="none",E.value=""),o.splice(t,1),B()}),w.appendChild(n)})}async function z(){m.setText(""),b.style.display="none",h.innerText="Espere un momento por favor",p(f),setTimeout(()=>{h.innerText="Estamos trabajando en ello..."},1500);try{let e=new FormData,t;o.forEach(c=>e.append("files",c)),i.value.trim()===""?d.checked?t="Resume este archivo o archivos ":l.checked&&(t="Extrae la información de este archivo o archivos "):t=i.value.trim(),e.append("question",t);const n=await fetch("http://chat.lexialegal.site/analizar",{method:"POST",body:e}),a=await n.json();n.ok&&(h.innerText="",h.innerText="¡Ya casi está listo!",setTimeout(()=>{g(f),P(a.answer,3)},1500))}catch{p(k),g(k,2e3)}}
